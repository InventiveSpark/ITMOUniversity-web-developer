<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Самостоятельная работа &#8470;8.4. Изменение оформления формы при вводе ошибочных данных</title>
</head>

<body>

    <form method="post">
        <label>
            Имя: <br><input type="text" name="Fname" placeholder="Имя">
        </label><br>
        <label>
            Фамилия: <br><input type="text" name="Lname" placeholder="Фамилия">
        </label><br>
        <!--При потере фокуса с этого поля ввода возникает событие метода 
            onBlur(), который вызывает функцию ValidateEmail(), проверяющую 
            структуру данных (адрес электронной почты), введённых пользователем.
            Для фильтрации ввода адреса электронной почты на уровне кода HTML,
            элементу формы можно задать атрибут type="email".
            Подробнее см.: https://html.spec.whatwg.org/multipage/input.html#email-state-(type=email)
        -->
        <label>
            Email: <br><input type="text" name="Email" placeholder="Адрес E-mail" onblur="checkInputEmail(this.value)">
        </label><br>
        <!--Элемент формы с атрибутом type="submit" - это кнопка, которая 
            отправляет данные формы на сервер. При нажатии на такую кнопку после
            выполнения обработчика (если он не вернёт false) страница будет 
            сразу обновляться, тем самым стирая результат выполнения скрипта 
            и очищая консоль. 
            Поэтому кнопке задан тип "button", т.е. это - обычная кнопка, на
            которую можно повесить любой обработчик JavaScript. В данном случае
            это функция formSubmit(). Обычная кнопка страницу обновлять 
            не будет: -->
        <input name="Submit" value="Submit" type="button" onclick="formSubmit()">
        <!--Кнопка для возвращения данных формы к первоначальным значениям. При
            нажатии на кнопку вызывается обработчик resetStyles(), 
            восстанавливающий стилевые свойства поля ввода Email: -->
        <input name="Reset" value="Reset" type="reset" onclick="resetStyles()">
    </form>

    <script>
        {
            "use strict";
            /* Константа, ссылающаяся на список style стилевых свойств поля 
               ввода с атрибутом name="Email", находящегося внутри первой формы 
               документа. Стилевые свойства в этом списке могут меняться в ходе
               выполнения скрипта: */
            const EMAILSTYLE = document.forms[0].Email.style;
            // Эквивалентно:
            //const EMAILSTYLE = document.querySelector('form input[name="Email"]').style;
            /* Константы, задающие стилевые свойства цвета, шрифта и внешней 
               границы поля ввода по умолчанию. Эти значения неизменны: */
            const defColor = EMAILSTYLE.color;
            const defFontSize = EMAILSTYLE.fontSize;
            const defBorder = EMAILSTYLE.border;

            /* Функция восстанавливает стилевые свойства поля ввода с атрибутом 
               name="Email": */
            function resetStyles() {
                EMAILSTYLE.color = defColor;
                EMAILSTYLE.fontSize = defFontSize;
                EMAILSTYLE.border = defBorder;
            }

            /* Функция validateEmail() проверяет на соответствие стандартам
               адрес электронной почты, переданный ей в виде строки. 
               Возвращает true, если адрес записан верно, иначе возвращает 
               false. */
            function validateEmail(email) {
                /* Метод test() выполняет поиск сопоставления регулярного 
                   выражения указанной строке. Возвращает true или false. 
                   Регулярное выражение проверяет адрес электронной почты. 
                   Работает в 99,99% случаев и соответствует всем стандартам.
                   Подробнее см.: https://emailregex.com */
                return (/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email));
            }

            /* Функция checkInputEmail() проверяет адрес электронной почты, 
               переданный ей в виде строки. Если адрес задан неверно, 
               изменяет стилевые свойства цвета, шрифта и внешней границы поля
               ввода: */
            function checkInputEmail(EmailAddress) {
                /* Если поле ввода пустое или адрес задан верно, то стилевые
                   свойства восстанавливаются: */
                if (EmailAddress.length === 0 || validateEmail(EmailAddress.trim()))
                    resetStyles();
                // Если адрес задан с ошибкой, то у поля ввода изменяются:
                else {
                    // цвет шрифта
                    EMAILSTYLE.color = "red";
                    // размер шрифта
                    EMAILSTYLE.fontSize = "18px";
                    // внешняя граница
                    EMAILSTYLE.border = "1px solid red";
                }
            }

            /* Функция formSubmit() отвечает за обработку формы. Если введённые 
               пользователем данные введены неправильно или неполностью, то 
               выводится сообщение. Если данные верны, то производится переход 
               на страницу поиска по введённым данным: */
            function formSubmit() {
                /* В переменные записываются данные из полей ввода имени, 
                   фамилии и адреса электронной почты с удаленными посредством 
                   метода trim() пробельными символами с начала и конца строки.
                   Атрибут name отправляется серверу вместе со значением 
                   элемента формы. Для доступа к полям ввода используется 
                   DOM-метод document.querySelector(), который возвращает первый
                   (в последовательности документа) элемент, соответствующий CSS
                   селектору, или null, если соответствующий элемент не найден. 
                   Когда элемент найден, им можно управлять при помощи 
                   JavaScript-кода. */
                let Fname = document.querySelector('input[name="Fname"]').value.trim();
                let Lname = document.querySelector('input[name="Lname"]').value.trim();
                let Email = document.querySelector('input[name="Email"]').value.trim();
                /* В переменной errMsg будет формироваться сообщение об ошибке. 
                   Переменной присвоена пустая строка для того, чтобы задать ей 
                   тип string вместо undefined, что обеспечит чистую конкатенацию: */
                let errMsg = "";
                if (Fname === "") errMsg += " • Имя\n";
                if (Lname === "") errMsg += " • Фамилию\n";
                if (!validateEmail(Email)) errMsg += " • Email (формат: имя_ящика@платформа)";
                /* Если пользователь не ввёл данные, ввёл их не полностью, или 
                   ввёл некорректный адрес электронной почты, то выводится 
                   сообщение для пользователя: */
                if (errMsg !== "") {
                    errMsg = "Введите:\n" + errMsg;
                    alert(errMsg);
                }
                /* Если пользователь ввёл все данные и корректный адрес 
                   электронной почты, то производится переход на страницу поиска
                   по введённым данным: */
                else {
                    // Создание url со строкой поиска
                    let url = new URL("https://yandex.ru/search/?text=")
                    /* Добавление к нему параметра поиска text, содержащего 
                       пробелы и символы кириллицы: */
                    url.searchParams.set('text', (Email + " " + Fname + " " + Lname));
                    // Переход на страницу поиска
                    document.location.href = url;
                    /* Или так, чтобы в истории браузера не осталась запись 
                       о текущей странице: */
                    //document.location.replace(url);
                }
            }
        }
    </script>

</body>

</html>